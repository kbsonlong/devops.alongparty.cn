[{"categories":null,"content":"Ingress èµ„æºæ˜¯ Kubernetes ä¼—å¤šæˆåŠŸæ•…äº‹ä¹‹ä¸€ã€‚å®ƒåˆ›å»ºäº†ä¸€ä¸ªä¸åŒçš„ Ingress æ§åˆ¶å™¨ç”Ÿæ€ç³»ç»Ÿï¼Œè¿™äº›æ§åˆ¶å™¨ä»¥æ ‡å‡†åŒ–å’Œä¸€è‡´çš„æ–¹å¼åœ¨æˆåƒä¸Šä¸‡çš„é›†ç¾¤ä¸­ä½¿ç”¨ã€‚è¿™ç§æ ‡å‡†åŒ–å¸®åŠ©ç”¨æˆ·é‡‡ç”¨ Kubernetesã€‚ç„¶è€Œï¼Œåœ¨ Ingress åˆ›å»º 5 å¹´åï¼Œæœ‰è¿¹è±¡è¡¨æ˜ï¼Œåˆ†è£‚ä¸ºä¸åŒä½†æƒŠäººç›¸ä¼¼çš„ CRD å’Œè¶…è½½çš„æ³¨é‡Šã€‚ä½¿ Ingress æ™®åŠçš„å¯ç§»æ¤æ€§åŒæ ·ä¹Ÿé™åˆ¶äº†å®ƒçš„æœªæ¥ã€‚ åœ¨ 2019 å¹´åœ£åœ°äºšå“¥ Kubecon å¤§ä¼šä¸Šï¼Œä¸€ç¾¤çƒ­æƒ…çš„è´¡çŒ®è€…èšé›†åœ¨ä¸€èµ·è®¨è®º Ingress çš„æ¼”å˜ã€‚è®¨è®ºè”“å»¶åˆ°äº†è¡—å¯¹é¢çš„é…’åº—å¤§å…ï¼Œç»“æœå°±æ˜¯åæ¥è¢«ç§°ä¸º Gateway API çš„ä¸œè¥¿ã€‚è¿™ä¸€è®¨è®ºæ˜¯åŸºäºä»¥ä¸‹å‡ ä¸ªå…³é”®å‡è®¾ï¼š ä½œä¸ºè·¯ç”±åŒ¹é…ã€æµé‡ç®¡ç†å’ŒæœåŠ¡æš´éœ²åŸºç¡€çš„ API æ ‡å‡†å·²ç»å•†å“åŒ–ï¼Œä½œä¸ºè‡ªå®šä¹‰ API å¯¹å…¶å®ç°è€…å’Œç”¨æˆ·å‡ ä¹æ²¡æœ‰æä¾›ä»€ä¹ˆä»·å€¼ å¯ä»¥é€šè¿‡å…±åŒçš„æ ¸å¿ƒ API èµ„æºæ¥è¡¨ç¤º L4/L7 è·¯ç”±å’Œæµé‡ç®¡ç† ä»¥ä¸€ç§ä¸ç‰ºç‰²æ ¸å¿ƒ API çš„ç”¨æˆ·ä½“éªŒçš„æ–¹å¼ï¼Œä¸ºæ›´å¤æ‚çš„åŠŸèƒ½æä¾›å¯æ‰©å±•æ€§æ˜¯å¯èƒ½çš„ ","date":"2022-07-29","objectID":"/gateway-api/:0:0","tags":null,"title":"é€šè¿‡Gateway APIä¸æ–­æ¼”å˜çš„Kubernetesç½‘ç»œ","uri":"/gateway-api/"},{"categories":null,"content":"å¼•å…¥ Gateway API è¿™å°±å¼•å‡ºäº†å…è®¸ Gateway API åœ¨ Ingress åŸºç¡€ä¸Šæ”¹è¿›çš„è®¾è®¡åŸåˆ™ï¼š è¡¨è¾¾èƒ½åŠ›â€”â€”é™¤äº† HTTP ä¸»æœº/è·¯å¾„åŒ¹é…å’Œ TLS ä¹‹å¤–ï¼ŒGateway API è¿˜å¯ä»¥è¡¨è¾¾ HTTP å¤´æ“ä½œã€æµé‡åŠ æƒå’Œé•œåƒã€TCP/UDP è·¯ç”±ä»¥åŠå…¶ä»–åªèƒ½åœ¨ Ingress ä¸­é€šè¿‡è‡ªå®šä¹‰æ³¨é‡Šæ‰èƒ½å®ç°çš„åŠŸèƒ½ã€‚ é¢å‘è§’è‰²çš„è®¾è®¡â€”â€”API èµ„æºæ¨¡å‹åæ˜ äº†åœ¨è·¯ç”±å’Œ Kubernetes æœåŠ¡ç½‘ç»œä¸­å¸¸è§çš„èŒè´£åˆ†ç¦»ã€‚ å¯æ‰©å±•æ€§â€”â€”èµ„æºå…è®¸åœ¨ API çš„ä¸åŒå±‚ä¸Šé™„åŠ ä»»æ„çš„é…ç½®ã€‚è¿™ä½¿å¾—åœ¨æœ€åˆé€‚çš„åœ°æ–¹å¯ä»¥è¿›è¡Œç»†ç²’åº¦å®šåˆ¶ã€‚ çµæ´»çš„ä¸€è‡´æ€§â€”â€”Gateway API å®šä¹‰äº†ä¸åŒçš„ä¸€è‡´æ€§çº§åˆ«â€”â€”æ ¸å¿ƒï¼ˆå¼ºåˆ¶æ”¯æŒï¼‰ã€æ‰©å±•ï¼ˆå¦‚æœæ”¯æŒåˆ™å¯ç§»æ¤ï¼‰å’Œè‡ªå®šä¹‰ï¼ˆæ²¡æœ‰å¯ç§»æ¤æ€§ä¿è¯ï¼‰ï¼Œç»Ÿç§°ä¸ºçµæ´»çš„ä¸€è‡´æ€§[1]ã€‚è¿™ä¿ƒè¿›äº†ä¸€ä¸ªé«˜åº¦å¯ç§»æ¤çš„æ ¸å¿ƒ APIï¼ˆå¦‚ Ingressï¼‰ï¼Œå®ƒä»ç„¶ä¸ºç½‘å…³æ§åˆ¶å™¨å®ç°è€…æä¾›çµæ´»æ€§ã€‚ ","date":"2022-07-29","objectID":"/gateway-api/:1:0","tags":null,"title":"é€šè¿‡Gateway APIä¸æ–­æ¼”å˜çš„Kubernetesç½‘ç»œ","uri":"/gateway-api/"},{"categories":null,"content":"Gateway API æ˜¯ä»€ä¹ˆæ ·å­çš„ï¼Ÿ Gateway API å¼•å…¥äº†ä¸€äº›æ–°çš„èµ„æºç±»å‹ï¼š GatewayClasses æ˜¯é›†ç¾¤èŒƒå›´çš„èµ„æºï¼Œä½œä¸ºæ¨¡æ¿æ¥æ˜¾å¼å®šä¹‰ä»å®ƒä»¬æ´¾ç”Ÿçš„ Gateways çš„è¡Œä¸ºã€‚è¿™åœ¨æ¦‚å¿µä¸Šç±»ä¼¼äº StorageClassesï¼Œä½†ç”¨äºè”ç½‘æ•°æ®å¹³é¢ã€‚ Gateways æ˜¯ GatewayClasses çš„éƒ¨ç½²å®ä¾‹ã€‚å®ƒä»¬æ˜¯æ‰§è¡Œè·¯ç”±çš„æ•°æ®å¹³é¢çš„é€»è¾‘è¡¨ç¤ºï¼Œå¯ä»¥æ˜¯é›†ç¾¤å†…ä»£ç†ã€ç¡¬ä»¶ LB æˆ–äº‘ LBã€‚ è·¯ç”±ä¸æ˜¯å•ä¸€çš„èµ„æºï¼Œè€Œæ˜¯ä»£è¡¨è®¸å¤šä¸åŒåè®®ç‰¹å®šçš„ Route èµ„æºã€‚HTTPRoute å…·æœ‰åŒ¹é…ã€è¿‡æ»¤å’Œè·¯ç”±è§„åˆ™ï¼Œè¿™äº›è§„åˆ™åº”ç”¨äºèƒ½å¤Ÿå¤„ç† HTTP å’Œ HTTPS æµé‡çš„ Gatewaysã€‚ç±»ä¼¼åœ°ï¼ŒTCPRoutesã€UDPRoutes å’Œ TLSRoutes ä¹Ÿå…·æœ‰ç‰¹å®šäºåè®®çš„è¯­ä¹‰ã€‚æ­¤æ¨¡å‹è¿˜å…è®¸ Gateway API å°†æ¥å¢é‡åœ°æ‰©å±•å…¶åè®®æ”¯æŒã€‚ ","date":"2022-07-29","objectID":"/gateway-api/:1:1","tags":null,"title":"é€šè¿‡Gateway APIä¸æ–­æ¼”å˜çš„Kubernetesç½‘ç»œ","uri":"/gateway-api/"},{"categories":null,"content":"ç½‘å…³æ§åˆ¶å™¨å®ç° å¥½æ¶ˆæ¯æ˜¯ï¼Œå°½ç®¡ Gateway æ˜¯åœ¨Alpha[2]é˜¶æ®µï¼Œä½†å·²ç»æœ‰å‡ ä¸ªä½ å¯ä»¥è¿è¡Œçš„Gateway æ§åˆ¶å™¨å®ç°[3]ã€‚ç”±äºå®ƒæ˜¯ä¸€ä¸ªæ ‡å‡†åŒ–çš„è§„èŒƒï¼Œä¸‹é¢çš„ç¤ºä¾‹å¯ä»¥åœ¨å®ƒä»¬ä¸­çš„ä»»ä½•ä¸€ä¸ªä¸Šè¿è¡Œï¼Œå¹¶ä¸”åº”è¯¥ä»¥å®Œå…¨ç›¸åŒçš„æ–¹å¼å·¥ä½œã€‚æŸ¥çœ‹å…¥é—¨æ‰‹å†Œ[4]ï¼Œäº†è§£å¦‚ä½•å®‰è£…å’Œä½¿ç”¨è¿™äº›ç½‘å…³æ§åˆ¶å™¨ä¹‹ä¸€ã€‚ ","date":"2022-07-29","objectID":"/gateway-api/:1:2","tags":null,"title":"é€šè¿‡Gateway APIä¸æ–­æ¼”å˜çš„Kubernetesç½‘ç»œ","uri":"/gateway-api/"},{"categories":null,"content":"Gateway API ä¾‹å­ åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†æ¼”ç¤ºä¸åŒ API èµ„æºä¹‹é—´çš„å…³ç³»ï¼Œå¹¶å¸¦ä½ æµè§ˆä¸€ä¸ªå¸¸è§çš„ç”¨ä¾‹ï¼š å›¢é˜Ÿ foo å°†ä»–ä»¬çš„åº”ç”¨éƒ¨ç½²åœ¨ foo å‘½åç©ºé—´ä¸­ã€‚ä»–ä»¬éœ€è¦æ§åˆ¶åº”ç”¨ç¨‹åºä¸åŒé¡µé¢çš„è·¯ç”±é€»è¾‘ã€‚ å›¢é˜Ÿ bar è¿è¡Œåœ¨ bar å‘½åç©ºé—´ä¸­ã€‚ä»–ä»¬å¸Œæœ›èƒ½å¤Ÿå¯¹ä»–ä»¬çš„åº”ç”¨è¿›è¡Œè“ç»¿å‘å¸ƒä»¥é™ä½é£é™©ã€‚ å¹³å°å›¢é˜Ÿè´Ÿè´£ç®¡ç† Kubernetes é›†ç¾¤ä¸­æ‰€æœ‰åº”ç”¨çš„è´Ÿè½½å‡è¡¡å™¨å’Œç½‘ç»œå®‰å…¨ã€‚ ä¸‹é¢çš„ foo-route å¯¹ foo å‘½åç©ºé—´ä¸­çš„å„ç§æœåŠ¡è¿›è¡Œè·¯å¾„åŒ¹é…ï¼Œå¹¶ä¸”è¿˜æœ‰ä¸€ä¸ªåˆ° 404 æœåŠ¡å™¨çš„é»˜è®¤è·¯ç”±ã€‚è¿™å°†åˆ†åˆ«é€šè¿‡ foo.example.com/login å’Œ foo.example.com/home æš´éœ² foo-auth å’Œ foo-home æœåŠ¡ï¼š kind:Â HTTPRoute apiVersion:Â networking.x-k8s.io/v1alpha1 metadata: name:Â foo-route namespace:Â foo labels: gateway:Â external-https-prod spec: hostnames: -Â \"foo.example.com\" rules: -Â matches: -Â path: type:Â Prefix value:Â /login forwardTo: -Â serviceName:Â foo-auth port:Â 8080 -Â matches: -Â path: type:Â Prefix value:Â /home forwardTo: -Â serviceName:Â foo-home port:Â 8080 -Â matches: -Â path: type:Â Prefix value:Â / forwardTo: -Â serviceName:Â foo-404 port:Â 8080 bar å›¢é˜Ÿåœ¨åŒä¸€ä¸ª Kubernetes é›†ç¾¤çš„ bar å‘½åç©ºé—´ä¸­æ“ä½œï¼Œä¹Ÿå¸Œæœ›å°†ä»–ä»¬çš„åº”ç”¨ç¨‹åºæš´éœ²ç»™äº’è”ç½‘ï¼Œä½†ä»–ä»¬ä¹Ÿå¸Œæœ›æ§åˆ¶è‡ªå·±çš„ç°åº¦å’Œè“ç»¿å‘å¸ƒã€‚ä¸‹é¢çš„ HTTPRoute è¢«é…ç½®ä¸ºä»¥ä¸‹è¡Œä¸ºï¼š bar.example.com çš„æµé‡ï¼š å°† 90%çš„æµé‡å‘é€åˆ° bar-v1 å°† 10%çš„æµé‡å‘é€ç»™ bar-v2 å¯¹äºä½¿ç”¨ HTTP å¤´ env:canary åˆ° bar.example.com çš„æµé‡ï¼š å°†æ‰€æœ‰æµé‡å‘é€åˆ° bar-v2 kind:Â HTTPRoute apiVersion:Â networking.x-k8s.io/v1alpha1 metadata: name:Â bar-route namespace:Â bar labels: gateway:Â external-https-prod spec: hostnames: -Â \"bar.example.com\" rules: -Â forwardTo: -Â serviceName:Â bar-v1 port:Â 8080 weight:Â 90 -Â serviceName:Â bar-v2 port:Â 8080 weight:Â 10 -Â matches: -Â headers: values: env:Â canary forwardTo: -Â serviceName:Â bar-v2 port:Â 8080 ","date":"2022-07-29","objectID":"/gateway-api/:2:0","tags":null,"title":"é€šè¿‡Gateway APIä¸æ–­æ¼”å˜çš„Kubernetesç½‘ç»œ","uri":"/gateway-api/"},{"categories":null,"content":"è·¯ç”±å’Œç½‘å…³ç»‘å®š å› æ­¤ï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªåŒ¹é…çš„ HTTPRoutesï¼Œå¹¶å°†æµé‡è·¯ç”±åˆ°ä¸åŒçš„æœåŠ¡ã€‚ä½ å¯èƒ½æƒ³çŸ¥é“ï¼Œåœ¨å“ªé‡Œå¯ä»¥è®¿é—®è¿™äº›æœåŠ¡ï¼Ÿå®ƒä»¬é€šè¿‡å“ªäº›ç½‘ç»œæˆ– IP æš´éœ²ï¼Ÿ è·¯ç”±å¦‚ä½•å‘å®¢æˆ·ç«¯æš´éœ²ç”±è·¯ç”±ç»‘å®š[5]æ¥ç®¡ç†ï¼Œè¯¥ç»‘å®šæè¿°äº†è·¯ç”±å’Œç½‘å…³ä¹‹é—´å¦‚ä½•åˆ›å»ºåŒå‘å…³ç³»ã€‚å½“ Routes è¢«ç»‘å®šåˆ°ä¸€ä¸ª Gateway æ—¶ï¼Œè¿™æ„å‘³ç€å®ƒä»¬çš„é›†åˆè·¯ç”±è§„åˆ™è¢«é…ç½®åœ¨åº•å±‚çš„è´Ÿè½½å‡è¡¡å™¨æˆ–ä»£ç†ä¸Šï¼Œå¹¶ä¸”è·¯ç”±å¯ä»¥é€šè¿‡ç½‘å…³è®¿é—®ã€‚å› æ­¤ï¼Œç½‘å…³æ˜¯å¯ä»¥é€šè¿‡è·¯ç”±é…ç½®çš„ç½‘ç»œæ•°æ®å¹³é¢çš„é€»è¾‘è¡¨ç¤ºã€‚ ","date":"2022-07-29","objectID":"/gateway-api/:2:1","tags":null,"title":"é€šè¿‡Gateway APIä¸æ–­æ¼”å˜çš„Kubernetesç½‘ç»œ","uri":"/gateway-api/"},{"categories":null,"content":"è¡Œæ”¿å§”æ‰˜ Gateway å’Œ Route èµ„æºä¹‹é—´çš„åˆ†ç¦»å…è®¸é›†ç¾¤ç®¡ç†å‘˜å°†ä¸€äº›è·¯ç”±é…ç½®å§”æ´¾ç»™å„ä¸ªå›¢é˜Ÿï¼ŒåŒæ—¶ä»ç„¶ä¿æŒé›†ä¸­æ§åˆ¶ã€‚ä»¥ä¸‹ç½‘å…³èµ„æºåœ¨ç«¯å£ 443 ä¸Šæš´éœ² HTTPSï¼Œå¹¶ä½¿ç”¨ç”±é›†ç¾¤ç®¡ç†å‘˜æ§åˆ¶çš„è¯ä¹¦ç»ˆæ­¢ç«¯å£ä¸Šçš„æ‰€æœ‰é€šä¿¡æµã€‚ kind:Â Gateway apiVersion:Â networking.x-k8s.io/v1alpha1 metadata: name:Â prod-web spec: gatewayClassName:Â acme-lb listeners: -Â protocol:Â HTTPS port:Â 443 routes: kind:Â HTTPRoute selector: matchLabels: gateway:Â external-https-prod namespaces: from:Â All tls: certificateRef: name:Â admin-controlled-cert ä¸‹é¢çš„ HTTPRoute å±•ç¤ºäº† Route å¦‚ä½•é€šè¿‡å®ƒçš„ kindï¼ˆHTTPRouteï¼‰å’Œèµ„æºæ ‡ç­¾ï¼ˆgateway=external-https-prodï¼‰æ¥ç¡®ä¿å®ƒåŒ¹é…ç½‘å…³çš„é€‰æ‹©å™¨ã€‚ #Â MatchesÂ theÂ requiredÂ kindÂ selectorÂ onÂ theÂ Gateway kind:Â HTTPRoute apiVersion:Â networking.x-k8s.io/v1alpha1 metadata: name:Â foo-route namespace:Â foo-ns labels: #Â MatchesÂ theÂ requiredÂ labelÂ selectorÂ onÂ theÂ Gateway gateway:Â external-https-prod ... ","date":"2022-07-29","objectID":"/gateway-api/:2:2","tags":null,"title":"é€šè¿‡Gateway APIä¸æ–­æ¼”å˜çš„Kubernetesç½‘ç»œ","uri":"/gateway-api/"},{"categories":null,"content":"é¢å‘è§’è‰²çš„è®¾è®¡ å½“ä½ å°†å®ƒä»¬æ”¾åœ¨ä¸€èµ·æ—¶ï¼Œä½ å°±æ‹¥æœ‰äº†ä¸€ä¸ªå¯ä»¥è¢«å¤šä¸ªå›¢é˜Ÿå®‰å…¨åœ°å…±äº«çš„è´Ÿè½½å¹³è¡¡åŸºç¡€è®¾æ–½ã€‚Gateway API ä¸ä»…æ˜¯ç”¨äºé«˜çº§è·¯ç”±çš„æ›´å…·è¡¨ç°åŠ›çš„ APIï¼Œè€Œä¸”æ˜¯é¢å‘è§’è‰²çš„ APIï¼Œä¸“ä¸ºå¤šç§Ÿæˆ·åŸºç¡€è®¾æ–½è®¾è®¡ã€‚å®ƒçš„å¯æ‰©å±•æ€§ç¡®ä¿äº†å®ƒå°†åœ¨ä¿æŒå¯ç§»æ¤æ€§çš„åŒæ—¶ä¸ºæœªæ¥çš„ç”¨ä¾‹å‘å±•ã€‚æœ€ç»ˆï¼Œè¿™äº›ç‰¹æ€§å°†å…è®¸ Gateway API é€‚åº”ä¸åŒçš„ç»„ç»‡æ¨¡å‹å’Œå®ç°ï¼Œç›´åˆ°æœªæ¥ã€‚ ","date":"2022-07-29","objectID":"/gateway-api/:2:3","tags":null,"title":"é€šè¿‡Gateway APIä¸æ–­æ¼”å˜çš„Kubernetesç½‘ç»œ","uri":"/gateway-api/"},{"categories":null,"content":"å°è¯•ä¸€ä¸‹ï¼Œå¹¶å‚ä¸å…¶ä¸­ æœ‰è®¸å¤šèµ„æºå¯ä»¥æŸ¥çœ‹ä»¥äº†è§£æ›´å¤šã€‚ æŸ¥çœ‹å…¥é—¨æ‰‹å†Œï¼Œçœ‹çœ‹å¯ä»¥è§£å†³å“ªäº›ç”¨ä¾‹ã€‚ å°è¯•ä½¿ç”¨ç°æœ‰çš„ç½‘å…³æ§åˆ¶å™¨ä¹‹ä¸€ æˆ–è€…å‚ä¸[6]å¹¶å¸®åŠ©è®¾è®¡å’Œå½±å“ Kubernetes æœåŠ¡ç½‘ç»œçš„æœªæ¥ï¼ ","date":"2022-07-29","objectID":"/gateway-api/:2:4","tags":null,"title":"é€šè¿‡Gateway APIä¸æ–­æ¼”å˜çš„Kubernetesç½‘ç»œ","uri":"/gateway-api/"},{"categories":null,"content":"å‚è€ƒèµ„æ–™ [1] çµæ´»çš„ä¸€è‡´æ€§: https://gateway-api.sigs.k8s.io/concepts/guidelines/#conformance [2] Alpha: https://github.com/kubernetes-sigs/gateway-api/releases [3] Gateway æ§åˆ¶å™¨å®ç°: https://gateway-api.sigs.k8s.io/references/implementations/ [4] å…¥é—¨æ‰‹å†Œ: https://gateway-api.sigs.k8s.io/guides/getting-started/ [5] è·¯ç”±ç»‘å®š: https://gateway-api.sigs.k8s.io/concepts/api-overview/#route-binding [6] å‚ä¸: https://gateway-api.sigs.k8s.io/contributing/community/ ","date":"2022-07-29","objectID":"/gateway-api/:2:5","tags":null,"title":"é€šè¿‡Gateway APIä¸æ–­æ¼”å˜çš„Kubernetesç½‘ç»œ","uri":"/gateway-api/"},{"categories":["Operator"],"content":"å®‰è£…kubebuilder brew install kubebuilder kubebuilder version ","date":"2022-07-21","objectID":"/kubebuilder%E5%BC%80%E5%8F%91operator/:0:1","tags":["kubebuilder","Operator"],"title":"Kubebuilderå¼€å‘ç®€å•çš„Operator","uri":"/kubebuilder%E5%BC%80%E5%8F%91operator/"},{"categories":["Operator"],"content":"åˆ›å»ºé¡¹ç›®ç›®å½• mkdir custom-controllers cd custom-controllers go mod init controllers.alongparty.cn ","date":"2022-07-21","objectID":"/kubebuilder%E5%BC%80%E5%8F%91operator/:0:2","tags":["kubebuilder","Operator"],"title":"Kubebuilderå¼€å‘ç®€å•çš„Operator","uri":"/kubebuilder%E5%BC%80%E5%8F%91operator/"},{"categories":["Operator"],"content":"kubebuilderåˆå§‹åŒ–é¡¹ç›® kubebuilder init --domain controller.alongparty.cn --license apache2 --owner \"kbsonlong\" kubebuilder create api --group controller --version v1 --kind Application make ","date":"2022-07-21","objectID":"/kubebuilder%E5%BC%80%E5%8F%91operator/:0:3","tags":["kubebuilder","Operator"],"title":"Kubebuilderå¼€å‘ç®€å•çš„Operator","uri":"/kubebuilder%E5%BC%80%E5%8F%91operator/"},{"categories":["Operator"],"content":"å‚è€ƒèµ„æ–™ ä½¿ç”¨kubebuilderå¼€å‘operatorè¯¦è§£ ","date":"2022-07-21","objectID":"/kubebuilder%E5%BC%80%E5%8F%91operator/:0:4","tags":["kubebuilder","Operator"],"title":"Kubebuilderå¼€å‘ç®€å•çš„Operator","uri":"/kubebuilder%E5%BC%80%E5%8F%91operator/"},{"categories":["Operator"],"content":"å‡†å¤‡å·¥ä½œ S2Iè‡ªå®šä¹‰é•œåƒæ„å»ºå™¨ â— assembleï¼ˆå¿…éœ€ï¼‰ï¼šä»æºä»£ç æ„å»ºåº”ç”¨ç¨‹åºåˆ¶å“çš„è„šæœ¬ assembleã€‚ â— runï¼ˆå¿…éœ€ï¼‰ï¼šç”¨äºè¿è¡Œåº”ç”¨ç¨‹åºçš„è„šæœ¬ã€‚ â— save-artifactsï¼ˆå¯é€‰ï¼‰ï¼šç®¡ç†å¢é‡æ„å»ºè¿‡ç¨‹ä¸­çš„æ‰€æœ‰ä¾èµ–ã€‚ â— usageï¼ˆå¯é€‰ï¼‰ï¼šæä¾›è¯´æ˜çš„è„šæœ¬ã€‚ â— test ï¼ˆå¯é€‰ï¼‰ï¼šç”¨äºæµ‹è¯•çš„è„šæœ¬ã€‚ ","date":"2022-07-21","objectID":"/s2i%E8%87%AA%E5%AE%9A%E4%B9%89%E6%9E%84%E5%BB%BA%E5%99%A8%E5%92%8C%E6%A8%A1%E6%9D%BF/:0:1","tags":["kubebuilder","Operator"],"title":"Kubesphere S2Iè‡ªå®šä¹‰æ„å»ºå™¨å’Œæ¨¡æ¿","uri":"/s2i%E8%87%AA%E5%AE%9A%E4%B9%89%E6%9E%84%E5%BB%BA%E5%99%A8%E5%92%8C%E6%A8%A1%E6%9D%BF/"},{"categories":["Operator"],"content":"åˆ›å»ºé•œåƒæ„å»ºå™¨ å‡†å¤‡S2Iç›®å½• å®‰è£…s2i wget https://github.com/openshift/source-to-image/releases/download/v1.2.04/source-to-image-v1.1.14-874754de-linux-386.tar.gz tar -xvf source-to-image-v1.1.14-874754de-linux-386.tar.gz ls s2i source-to-image-v1.1.14-874754de-linux-386.tar.gz sti cp s2i /usr/local/bin åˆå§‹åŒ–é•œåƒæ„å»ºå™¨ s2i create java-ubuntu22 java-ubuntu22 cd java-ubuntu22 ç›®å½•ç»“æ„åˆå§‹åŒ– . â”œâ”€â”€ Dockerfile â”œâ”€â”€ Makefile â”œâ”€â”€ README.md â”œâ”€â”€ prometheus-config.yml â”œâ”€â”€ s2i â”‚ â””â”€â”€ bin â”‚ â”œâ”€â”€ assemble â”‚ â”œâ”€â”€ run â”‚ â”œâ”€â”€ save-artifacts â”‚ â””â”€â”€ usage â””â”€â”€ test â”œâ”€â”€ run â””â”€â”€ test-app â”œâ”€â”€ b2i-jar-java8.jar ## é»˜è®¤ä¸å­˜åœ¨ â””â”€â”€ index.html 4 directories, 11 files ","date":"2022-07-21","objectID":"/s2i%E8%87%AA%E5%AE%9A%E4%B9%89%E6%9E%84%E5%BB%BA%E5%99%A8%E5%92%8C%E6%A8%A1%E6%9D%BF/:0:2","tags":["kubebuilder","Operator"],"title":"Kubesphere S2Iè‡ªå®šä¹‰æ„å»ºå™¨å’Œæ¨¡æ¿","uri":"/s2i%E8%87%AA%E5%AE%9A%E4%B9%89%E6%9E%84%E5%BB%BA%E5%99%A8%E5%92%8C%E6%A8%A1%E6%9D%BF/"},{"categories":["Operator"],"content":"ä¿®æ”¹Dockerfile # java-ubuntu22 FROM ubuntu:22.04 # TODO: Put the maintainer name in the image metadata # LABEL maintainer=\"Your Name \u003cyour@email.com\u003e\" # TODO: Rename the builder environment variable to inform users about application you provide them # ENV BUILDER_VERSION 1.0 # TODO: Set labels used in OpenShift to describe the builder image LABEL io.k8s.description=\"Java 8 web application\" \\ io.k8s.display-name=\"Java 8 Web\" \\ io.openshift.expose-services=\"8080:http\" \\ io.openshift.tags=\"builder,java,web\" \\ # this label tells s2i where to find its mandatory scripts # (run, assemble, save-artifacts) io.openshift.s2i.scripts-url=\"image:///usr/libexec/s2i\" # TODO: Install required packages here: # RUN yum install -y ... \u0026\u0026 yum clean all -y RUN apt-get update \u0026\u0026 apt-get install -y \\ curl \\ wget \\ openjdk-8-jdk \u0026\u0026 \\ rm -rf /var/lib/apt/lists WORKDIR /opt # TODO (optional): Copy the builder files into /opt/app-root # COPY ./\u003cbuilder_folder\u003e/ /opt/app-root/ # TODO: Copy the S2I scripts to /usr/libexec/s2i, since openshift/base-centos7 image # sets io.openshift.s2i.scripts-url label that way, or update that label COPY ./s2i/bin/ /usr/libexec/s2i # TODO: Drop the root user and make the content of /opt/app-root owned by user 1001 # RUN chown -R 1001:1001 /opt/app-root RUN chgrp -R 0 /usr/libexec/s2i \\ \u0026\u0026 chmod -R u=rwx,go=rx /usr/libexec/s2i \u0026\u0026 \\ chgrp -R 0 /opt \\ \u0026\u0026 chmod -R u=rwx,go=rx /opt \u0026\u0026 \\ chown -R 1001:1001 /opt \u0026\u0026 \\ chown -R 1001:1001 /usr/libexec/s2i/assemble RUN mkdir -p /opt/prometheus/etc \\ \u0026\u0026 curl https://repo1.maven.org/maven2/io/prometheus/jmx/jmx_prometheus_javaagent/0.17.0/jmx_prometheus_javaagent-0.17.0.jar \\ -o /opt/prometheus/jmx_prometheus_javaagent.jar COPY prometheus-config.yml /opt/prometheus/etc # This default user is created in the openshift/base-centos7 image USER 1001 # TODO: Set the default port for applications built using this image EXPOSE 8080 # TODO: Set the default CMD for the image CMD [\"/usr/libexec/s2i/usage\"] ","date":"2022-07-21","objectID":"/s2i%E8%87%AA%E5%AE%9A%E4%B9%89%E6%9E%84%E5%BB%BA%E5%99%A8%E5%92%8C%E6%A8%A1%E6%9D%BF/:0:3","tags":["kubebuilder","Operator"],"title":"Kubesphere S2Iè‡ªå®šä¹‰æ„å»ºå™¨å’Œæ¨¡æ¿","uri":"/s2i%E8%87%AA%E5%AE%9A%E4%B9%89%E6%9E%84%E5%BB%BA%E5%99%A8%E5%92%8C%E6%A8%A1%E6%9D%BF/"},{"categories":["Operator"],"content":"ä¿®æ”¹S2Iè„šæœ¬ assemble #!/bin/bash -e # # S2I assemble script for the 'java-ubuntu22' image. # The 'assemble' script builds your application source so that it is ready to run. # # For more information refer to the documentation: # https://github.com/openshift/source-to-image/blob/master/docs/builder_image.md # # If the 'java-ubuntu22' assemble script is executed with the '-h' flag, print the usage. if [[ \"$1\" == \"-h\" ]]; then exec /usr/libexec/s2i/usage fi # Restore artifacts from the previous build (if they exist). # echo \"---\u003e Installing application...\" mkdir -p /opt/app ls /tmp/src/* mv /tmp/src/* /opt/app/ chmod +x /opt/app/*.jar é»˜è®¤æƒ…å†µä¸‹ï¼Œs2i buildå°†åº”ç”¨ç¨‹åºæºä»£ç æ”¾åœ¨/tmp/srcã€‚ä¸Šè¿°å‘½ä»¤å°†åº”ç”¨ç¨‹åºjaråŒ…å¤åˆ¶åˆ°/opt/app/ç›®å½•ä¸‹ run #!/bin/bash -e # # S2I run script for the 'java-ubuntu22' image. # The run script executes the server that runs your application. # # For more information see the documentation: # https://github.com/openshift/source-to-image/blob/master/docs/builder_image.md # PROMETHEUS_JMX_OPTS=\"-javaagent:/opt/prometheus/jmx_prometheus_javaagent.jar=${PROMETHEUS_JMX_PORT}:/opt/prometheus/etc/prometheus-config.yml\" # Always include jolokia-opts, which can be empty if switched off via env JAVA_OPTIONS=\"${JAVA_OPTIONS:+${JAVA_OPTIONS} }\" # Temporary options variable until the harmonization hawt-app PR #5 has been applied (hopefully) JVM_ARGS=\"${JVM_ARGS:+${JVM_ARGS} }${JAVA_OPTIONS} ${PROMETHEUS_JMX_OPTS}\" export JAVA_OPTIONS JVM_ARGS PROMETHEUS_JMX_OPTS exec java -jar ${JVM_ARGS} /opt/app/app.jar ","date":"2022-07-21","objectID":"/s2i%E8%87%AA%E5%AE%9A%E4%B9%89%E6%9E%84%E5%BB%BA%E5%99%A8%E5%92%8C%E6%A8%A1%E6%9D%BF/:0:4","tags":["kubebuilder","Operator"],"title":"Kubesphere S2Iè‡ªå®šä¹‰æ„å»ºå™¨å’Œæ¨¡æ¿","uri":"/s2i%E8%87%AA%E5%AE%9A%E4%B9%89%E6%9E%84%E5%BB%BA%E5%99%A8%E5%92%8C%E6%A8%A1%E6%9D%BF/"},{"categories":["Operator"],"content":"æ„å»ºä¸è¿è¡Œ åˆ›å»ºé•œåƒæ„å»ºå™¨ make build ä½¿ç”¨é•œåƒæ„å»ºå™¨åˆ›å»ºåº”ç”¨ç¨‹åºé•œåƒ # s2i build ./test/test-app java-ubuntu22 sample-app ---\u003e Installing application... /tmp/src/b2i-jar-java8.jar /tmp/src/index.html Build completed successfully æŒ‰ç…§assembleè„šæœ¬å®šä¹‰çš„é€»è¾‘ï¼ŒS2Iä½¿ç”¨é•œåƒæ„å»ºå™¨ä½œä¸ºåŸºç¡€åˆ›å»ºåº”ç”¨ç¨‹åºé•œåƒï¼Œå¹¶ä»test/test-appç›®å½•æ³¨å…¥æºä»£ç ã€‚ æµ‹è¯•è¿è¡Œåº”ç”¨ç¨‹åºé•œåƒ # docker run -p 8080:8080 -p 12345:12345 -e PROMETHEUS_JMX_PORT=12345 sample-app . ____ _ __ _ _ /\\\\ / ___'_ __ _ _(_)_ __ __ _ \\ \\ \\ \\ ( ( )\\___ | '_ | '_| | '_ \\/ _` | \\ \\ \\ \\ \\\\/ ___)| |_)| | | | | || (_| | ) ) ) ) ' |____| .__|_| |_|_| |_\\__, | / / / / =========|_|==============|___/=/_/_/_/ :: Spring Boot :: (v1.4.1.BUILD-SNAPSHOT) 2022-07-28 07:51:48.829 INFO 1 --- [ main] io.kubesphere.devops.Application : Starting Application v0.0.1-SNAPSHOT on 322634c30cc2 with PID 1 (/opt/app/app.jar started by ? in /opt) 2022-07-28 07:51:48.839 INFO 1 --- [ main] io.kubesphere.devops.Application : No active profile set, falling back to default profiles: default 2022-07-28 07:51:48.906 INFO 1 --- [ main] ationConfigEmbeddedWebApplicationContext : Refreshing org.springframework.boot.context.embedded.AnnotationConfigEmbeddedWebApplicationContext@5ae50ce6: startup date [Thu Jul 28 07:51:48 GMT 2022]; root of context hierarchy 2022-07-28 07:51:49.694 INFO 1 --- [ main] s.b.c.e.t.TomcatEmbeddedServletContainer : Tomcat initialized with port(s): 8080 (http) 2022-07-28 07:51:49.700 INFO 1 --- [ main] o.apache.catalina.core.StandardService : Starting service Tomcat 2022-07-28 07:51:49.701 INFO 1 --- [ main] org.apache.catalina.core.StandardEngine : Starting Servlet Engine: Apache Tomcat/8.5.5 2022-07-28 07:51:49.749 INFO 1 --- [ost-startStop-1] o.a.c.c.C.[Tomcat].[localhost].[/] : Initializing Spring embedded WebApplicationContext 2022-07-28 07:51:49.749 INFO 1 --- [ost-startStop-1] o.s.web.context.ContextLoader : Root WebApplicationContext: initialization completed in 845 ms 2022-07-28 07:51:49.820 INFO 1 --- [ost-startStop-1] o.s.b.w.servlet.ServletRegistrationBean : Mapping servlet: 'dispatcherServlet' to [/] 2022-07-28 07:51:49.822 INFO 1 --- [ost-startStop-1] o.s.b.w.servlet.FilterRegistrationBean : Mapping filter: 'characterEncodingFilter' to: [/*] 2022-07-28 07:51:49.822 INFO 1 --- [ost-startStop-1] o.s.b.w.servlet.FilterRegistrationBean : Mapping filter: 'hiddenHttpMethodFilter' to: [/*] 2022-07-28 07:51:49.823 INFO 1 --- [ost-startStop-1] o.s.b.w.servlet.FilterRegistrationBean : Mapping filter: 'httpPutFormContentFilter' to: [/*] 2022-07-28 07:51:49.823 INFO 1 --- [ost-startStop-1] o.s.b.w.servlet.FilterRegistrationBean : Mapping filter: 'requestContextFilter' to: [/*] 2022-07-28 07:51:49.988 INFO 1 --- [ main] s.w.s.m.m.a.RequestMappingHandlerAdapter : Looking for @ControllerAdvice: org.springframework.boot.context.embedded.AnnotationConfigEmbeddedWebApplicationContext@5ae50ce6: startup date [Thu Jul 28 07:51:48 GMT 2022]; root of context hierarchy 2022-07-28 07:51:50.047 INFO 1 --- [ main] s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped \"{[/]}\" onto public java.lang.String io.kubesphere.devops.HelloWorldController.sayHello() 2022-07-28 07:51:50.050 INFO 1 --- [ main] s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped \"{[/error],produces=[text/html]}\" onto public org.springframework.web.servlet.ModelAndView org.springframework.boot.autoconfigure.web.BasicErrorController.errorHtml(javax.servlet.http.HttpServletRequest,javax.servlet.http.HttpServletResponse) 2022-07-28 07:51:50.050 INFO 1 --- [ main] s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped \"{[/error]}\" onto public org.springframework.http.ResponseEntity\u003cjava.util.Map\u003cjava.lang.String, java.lang.Object\u003e\u003e org.springframework.boot.autoconfigure.web.BasicErrorController.error(javax.servlet.http.HttpServletRequest) 2022-07-28 07:51:50.063 INFO 1 --- [ main] o.s.w.s.handler.SimpleUrlHandlerMapping : Mapped URL path [/webjars/**] onto handler of type [class org.springframework.web.servlet.resource.ResourceHttpRequestHandler] 2022-07-28 07:51:50.063 INFO 1 --- [ main] o.s.w.s.handler.SimpleUrlHandlerMapping :","date":"2022-07-21","objectID":"/s2i%E8%87%AA%E5%AE%9A%E4%B9%89%E6%9E%84%E5%BB%BA%E5%99%A8%E5%92%8C%E6%A8%A1%E6%9D%BF/:0:5","tags":["kubebuilder","Operator"],"title":"Kubesphere S2Iè‡ªå®šä¹‰æ„å»ºå™¨å’Œæ¨¡æ¿","uri":"/s2i%E8%87%AA%E5%AE%9A%E4%B9%89%E6%9E%84%E5%BB%BA%E5%99%A8%E5%92%8C%E6%A8%A1%E6%9D%BF/"},{"categories":["Operator"],"content":"è‡ªå®šä¹‰S2Iæ¨¡æ¿ apiVersion: devops.kubesphere.io/v1alpha1 kind: S2iBuilderTemplate metadata: labels: controller-tools.k8s.io: \"1.0\" builder-type.kubesphere.io/s2i: \"s2i\" name: java-ubuntu spec: containerInfo: - builderImage: java-ubuntu22 ## è‡ªå®šä¹‰çš„é•œåƒæ„å»ºå™¨é•œåƒ codeFramework: java # type of code framework defaultBaseImage: java-ubuntu22 # default Image Builder (can be replaced by a customized image) version: 0.0.1 # Builder template version description: \"æ¨¡æ¿æè¿°\" # Builder template description kubectl apply -f s2ibuildertemplate.yaml æ ‡ç­¾åç§° é€‰é¡¹ å®šä¹‰ builder-type.kubesphere.io/s2i â€œs2iâ€ æ¨¡æ¿ç±»å‹ä¸º S2Iï¼ŒåŸºäºåº”ç”¨ç¨‹åºæºä»£ç æ„å»ºé•œåƒã€‚ builder-type.kubesphere.io/b2i â€œb2iâ€ æ¨¡æ¿ç±»å‹ä¸º B2Iï¼ŒåŸºäºäºŒè¿›åˆ¶æ–‡ä»¶æˆ–å…¶ä»–åˆ¶å“æ„å»ºé•œåƒã€‚ binary-type.kubesphere.io â€œjarâ€,â€œwarâ€,â€œbinaryâ€ è¯¥ç±»å‹ä¸º B2I ç±»å‹çš„è¡¥å……ï¼Œåœ¨é€‰æ‹© B2I ç±»å‹æ—¶éœ€è¦ã€‚ä¾‹å¦‚ï¼Œå½“æä¾› Jar åŒ…æ—¶ï¼Œé€‰æ‹© â€œjarâ€ ç±»å‹ã€‚åœ¨ KubeSphere v2.1.1 åŠæ›´é«˜ç‰ˆæœ¬ï¼Œå…è®¸è‡ªå®šä¹‰ B2I æ¨¡æ¿ã€‚ å®˜æ–¹demo apiVersion: devops.kubesphere.io/v1alpha1 kind: S2iBuilderTemplate metadata: annotations: descriptionCN: Java åº”ç”¨çš„æ„å»ºå™¨æ¨¡ç‰ˆã€‚é€šè¿‡è¯¥æ¨¡ç‰ˆå¯æ„å»ºå‡ºç›´æ¥è¿è¡Œçš„åº”ç”¨é•œåƒã€‚ descriptionEN: This is a builder template for Java builds whose result can be run directly without any further application server.It's suited ideally for microservices with a flat classpath (including \"far jars\"). devops.kubesphere.io/s2i-template-url: https://github.com/kubesphere/s2i-java-container/blob/master/java/images helm.sh/hook: pre-install labels: binary-type.kubesphere.io: jar builder-type.kubesphere.io/b2i: b2i builder-type.kubesphere.io/s2i: s2i controller-tools.k8s.io: \"1.0\" name: java spec: codeFramework: java containerInfo: - buildVolumes: - s2i_java_cache:/tmp/artifacts builderImage: 969049650220.dkr.ecr.ap-east-1.amazonaws.com/kubesphere/java-8-centos7:v3.2.0 runtimeArtifacts: - source: /deployments runtimeImage: 969049650220.dkr.ecr.ap-east-1.amazonaws.com/kubesphere/java-8-runtime:v3.2.0 - buildVolumes: - s2i_java_cache:/tmp/artifacts builderImage: 969049650220.dkr.ecr.ap-east-1.amazonaws.com/kubesphere/java-11-centos7:v3.2.0 runtimeArtifacts: - source: /deployments runtimeImage: 969049650220.dkr.ecr.ap-east-1.amazonaws.com/kubesphere/java-11-runtime:v3.2.0 defaultBaseImage: 969049650220.dkr.ecr.ap-east-1.amazonaws.com/kubesphere/java-8-centos7:v3.2.0 description: This is a builder template for Java builds whose result can be run directly without any further application server.It's suited ideally for microservices with a flat classpath (including \"far jars\") environment: - defaultValue: \"\" description: Arguments to use when calling Maven, replacing the default package hawt-app:build -DskipTests -e. Please be sure to run the hawt-app:build goal (when not already bound to the package execution phase), otherwise the startup scripts won't work. key: MAVEN_ARGS required: false type: string - defaultValue: \"\" description: Additional Maven arguments, useful for temporary adding arguments like -X or -am -pl . key: MAVEN_ARGS_APPEND required: false type: string - defaultValue: \"\" description: With Repositories you specify from which locations you want to download certain artifacts, such as dependencies and maven-plugins. key: MAVEN_MIRROR_URL required: false type: string - defaultValue: \"\" description: If set then the Maven repository is removed after the artifact is built. This is useful for keeping the created application image small, but prevents incremental builds. The default is false key: MAVEN_CLEAR_REPO required: false type: boolean - defaultValue: \"\" description: Path to target/ where the jar files are created for multi module builds. These are added to ${MAVEN_ARGS} key: ARTIFACT_DIR required: false type: string - defaultValue: \"\" description: Arguments to use when copying artifacts from the output dir to the application dir. Useful to specify which artifacts will be part of the image. It defaults to -r hawt-app/* when a hawt-app dir is found on the build directory, otherwise jar files only will be included (*.jar). key: ARTIFACT_COPY_ARGS required: false type: string - defaultValue: \"\" description: the directory where the application resides. All paths in your application are","date":"2022-07-21","objectID":"/s2i%E8%87%AA%E5%AE%9A%E4%B9%89%E6%9E%84%E5%BB%BA%E5%99%A8%E5%92%8C%E6%A8%A1%E6%9D%BF/:0:6","tags":["kubebuilder","Operator"],"title":"Kubesphere S2Iè‡ªå®šä¹‰æ„å»ºå™¨å’Œæ¨¡æ¿","uri":"/s2i%E8%87%AA%E5%AE%9A%E4%B9%89%E6%9E%84%E5%BB%BA%E5%99%A8%E5%92%8C%E6%A8%A1%E6%9D%BF/"},{"categories":["Operator"],"content":"å‚è€ƒèµ„æ–™ s2i-base-container s2i-java-container s2i-java-runtimeImage ","date":"2022-07-21","objectID":"/s2i%E8%87%AA%E5%AE%9A%E4%B9%89%E6%9E%84%E5%BB%BA%E5%99%A8%E5%92%8C%E6%A8%A1%E6%9D%BF/:0:7","tags":["kubebuilder","Operator"],"title":"Kubesphere S2Iè‡ªå®šä¹‰æ„å»ºå™¨å’Œæ¨¡æ¿","uri":"/s2i%E8%87%AA%E5%AE%9A%E4%B9%89%E6%9E%84%E5%BB%BA%E5%99%A8%E5%92%8C%E6%A8%A1%E6%9D%BF/"},{"categories":["VPN"],"content":"å®‰è£…ocserv apt-get install ocserv -y ","date":"2022-07-21","objectID":"/ocserv%E9%83%A8%E7%BD%B2/:0:1","tags":["Openconnect","Ocserv"],"title":"Openconnectéƒ¨ç½²","uri":"/ocserv%E9%83%A8%E7%BD%B2/"},{"categories":["VPN"],"content":"ç”³è¯·å…è´¹è¯ä¹¦ ä¿®æ”¹dnsæŒ‡å‘æœåŠ¡å™¨ ç”Ÿæˆè¯ä¹¦ certbot certonly --standalone --preferred-challenges http --agree-tos --email kbsonlong@gmail.com -d myvpn.alongparty.cn # ç»­ç­¾è¯ä¹¦ certbot renew --quiet --no-self-upgrade ","date":"2022-07-21","objectID":"/ocserv%E9%83%A8%E7%BD%B2/:0:2","tags":["Openconnect","Ocserv"],"title":"Openconnectéƒ¨ç½²","uri":"/ocserv%E9%83%A8%E7%BD%B2/"},{"categories":["VPN"],"content":"ä¿®æ”¹é…ç½® auth = \"plain[/etc/ocserv/ocpasswd]\" tcp-port = 443 udp-port = 443 run-as-user = nobody run-as-group = daemon socket-file = /var/run/ocserv-socket server-cert = /etc/letsencrypt/live/myvpn.alongparty.cn/fullchain.pem server-key = /etc/letsencrypt/live/myvpn.alongparty.cn/privkey.pem isolate-workers = false max-clients = 16 max-same-clients = 2 rate-limit-ms = 100 server-stats-reset-time = 604800 keepalive = 32400 dpd = 90 mobile-dpd = 1800 switch-to-tcp-timeout = 25 try-mtu-discovery = true cert-user-oid = 0.9.2342.19200300.100.1.1 tls-priorities = \"NORMAL:%SERVER_PRECEDENCE:%COMPAT:-VERS-SSL3.0:-VERS-TLS1.0:-VERS-TLS1.1\" auth-timeout = 240 min-reauth-time = 300 max-ban-score = 80 ban-reset-time = 1200 cookie-timeout = 300 deny-roaming = false rekey-time = 172800 rekey-method = ssl use-occtl = true pid-file = /var/run/ocserv.pid device = vpns predictable-ips = true default-domain = example.com ipv4-network = 10.255.255.0 ipv4-netmask = 255.255.255.0 tunnel-all-dns = true dns = 8.8.8.8 dns = 4.2.2.4 dns = 2001:4860:4860::8888 dns = 2001:4860:4860::8844 ping-leases = false cisco-client-compat = true dtls-legacy = true ","date":"2022-07-21","objectID":"/ocserv%E9%83%A8%E7%BD%B2/:0:3","tags":["Openconnect","Ocserv"],"title":"Openconnectéƒ¨ç½²","uri":"/ocserv%E9%83%A8%E7%BD%B2/"},{"categories":["VPN"],"content":"1.é¦–å…ˆæ·»åŠ ä¸¤ä¸ªå¸¦åˆ†ç»„çš„ç”¨æˆ· ocpasswd -c /etc/ocserv/ocpasswd -g gruop1 user1 ocpasswd -c /etc/ocserv/ocpasswd -g gruop2 user2 ","date":"2022-07-21","objectID":"/openconnect%E8%AE%BE%E7%BD%AE%E7%94%A8%E6%88%B7%E7%BB%84%E5%AE%9E%E7%8E%B0%E5%A4%9A%E8%B7%AF%E7%94%B1/:0:1","tags":["Openconnect","Ocserv"],"title":"Openconnectè®¾ç½®ç”¨æˆ·ç»„å®ç°å¤šè·¯ç”±è¡¨","uri":"/openconnect%E8%AE%BE%E7%BD%AE%E7%94%A8%E6%88%B7%E7%BB%84%E5%AE%9E%E7%8E%B0%E5%A4%9A%E8%B7%AF%E7%94%B1/"},{"categories":["VPN"],"content":"2.æ·»åŠ åˆ›å»ºè·¯ç”±è¡¨ç»„ mkdir /etc/ocserv/group echo -e \"route = 10.10.0.0/255.255.255.0\" \u003e\u003e /etc/ocserv/group/group1 echo -e \"no-route = 211.80.0.0/255.240.0.0\" \u003e\u003e /etc/ocserv/group/group2 ä»¥ä¸Šè¿ä¸ªè·¯ç”±è¡¨æ˜¯æ¼”ç¤ºgroup1å’Œgroup2éšä¾¿å†™çš„ è¯·è‡ªè¡Œæ·»åŠ è·¯ç”±è§„åˆ™ æ­¤å¤–è·¯ç”±è¡¨é‡Œè¿˜å¯ä»¥å†™DNS çŸ­çº¿æ—¶é—´çš„å‚æ•° ","date":"2022-07-21","objectID":"/openconnect%E8%AE%BE%E7%BD%AE%E7%94%A8%E6%88%B7%E7%BB%84%E5%AE%9E%E7%8E%B0%E5%A4%9A%E8%B7%AF%E7%94%B1/:0:2","tags":["Openconnect","Ocserv"],"title":"Openconnectè®¾ç½®ç”¨æˆ·ç»„å®ç°å¤šè·¯ç”±è¡¨","uri":"/openconnect%E8%AE%BE%E7%BD%AE%E7%94%A8%E6%88%B7%E7%BB%84%E5%AE%9E%E7%8E%B0%E5%A4%9A%E8%B7%AF%E7%94%B1/"},{"categories":["VPN"],"content":"3.æ·»åŠ æ–°çš„é…ç½®åˆ°ocserv.conf config-per-group = /etc/ocserv/group/ default-group-config = /etc/ocserv/group/group1 #å¦‚æœåˆ›å»ºç”¨æˆ·çš„æ—¶å€™ä¸åˆ†ç»„ group1å°±æ˜¯é»˜è®¤åˆ†ç»„ ç”¨çš„å°±æ˜¯group1çš„è·¯ç”±è¡¨ default-select-group = group1 #å¦‚æœåˆ›å»ºç”¨æˆ·çš„æ—¶å€™ä¸åˆ†ç»„ group1å°±æ˜¯é»˜è®¤åˆ†ç»„ ç”¨çš„å°±æ˜¯group1çš„è·¯ç”±è¡¨ auto-select-group = false ","date":"2022-07-21","objectID":"/openconnect%E8%AE%BE%E7%BD%AE%E7%94%A8%E6%88%B7%E7%BB%84%E5%AE%9E%E7%8E%B0%E5%A4%9A%E8%B7%AF%E7%94%B1/:0:3","tags":["Openconnect","Ocserv"],"title":"Openconnectè®¾ç½®ç”¨æˆ·ç»„å®ç°å¤šè·¯ç”±è¡¨","uri":"/openconnect%E8%AE%BE%E7%BD%AE%E7%94%A8%E6%88%B7%E7%BB%84%E5%AE%9E%E7%8E%B0%E5%A4%9A%E8%B7%AF%E7%94%B1/"},{"categories":["VPN"],"content":"4.å®Œæ•´é…ç½® auth = \"plain[/etc/ocserv/ocpasswd]\" tcp-port = 443 udp-port = 443 run-as-user = nobody run-as-group = daemon socket-file = /var/run/ocserv-socket server-cert = /etc/letsencrypt/live/myvpn.alongparty.cn/fullchain.pem server-key = /etc/letsencrypt/live/myvpn.alongparty.cn/privkey.pem isolate-workers = false max-clients = 16 max-same-clients = 2 rate-limit-ms = 100 server-stats-reset-time = 604800 keepalive = 32400 dpd = 90 mobile-dpd = 1800 switch-to-tcp-timeout = 25 try-mtu-discovery = true cert-user-oid = 0.9.2342.19200300.100.1.1 tls-priorities = \"NORMAL:%SERVER_PRECEDENCE:%COMPAT:-VERS-SSL3.0:-VERS-TLS1.0:-VERS-TLS1.1\" auth-timeout = 240 min-reauth-time = 300 max-ban-score = 80 ban-reset-time = 1200 cookie-timeout = 300 deny-roaming = false rekey-time = 172800 rekey-method = ssl use-occtl = true pid-file = /var/run/ocserv.pid device = vpns predictable-ips = true default-domain = example.com ipv4-network = 10.255.255.0 ipv4-netmask = 255.255.255.0 tunnel-all-dns = true dns = 8.8.8.8 dns = 4.2.2.4 dns = 2001:4860:4860::8888 dns = 2001:4860:4860::8844 ping-leases = false config-per-group = /etc/ocserv/group/ default-group-config = /etc/ocserv/group/default default-select-group = default auto-select-group = false cisco-client-compat = true dtls-legacy = true # cat /etc/ocserv/group/default route = 10.48.16.124/32 # cat /etc/ocserv/ocpasswd sysop01:sysop:$5$R7HQXGtZ1MpB.N82$iNf5viGa/XT/qLjfpFhPNqlvdEyw5KKaKZvK2jIVEG4 ","date":"2022-07-21","objectID":"/openconnect%E8%AE%BE%E7%BD%AE%E7%94%A8%E6%88%B7%E7%BB%84%E5%AE%9E%E7%8E%B0%E5%A4%9A%E8%B7%AF%E7%94%B1/:0:4","tags":["Openconnect","Ocserv"],"title":"Openconnectè®¾ç½®ç”¨æˆ·ç»„å®ç°å¤šè·¯ç”±è¡¨","uri":"/openconnect%E8%AE%BE%E7%BD%AE%E7%94%A8%E6%88%B7%E7%BB%84%E5%AE%9E%E7%8E%B0%E5%A4%9A%E8%B7%AF%E7%94%B1/"},{"categories":["VPN"],"content":"ä¿®æ”¹è®¤è¯æ–¹å¼ # vim /etc/ocserv/ocserv.conf auth = \"plain[passwd=/etc/ocserv/ocpasswd,otp=/etc/ocserv/ocserv.otp]\" ","date":"2022-07-21","objectID":"/openconnect%E5%8F%8C%E5%9B%A0%E7%B4%A0%E8%AE%A4%E8%AF%81/:0:1","tags":["Openconnect","Ocserv"],"title":"OpenconnectåŒå› ç´ è®¤è¯","uri":"/openconnect%E5%8F%8C%E5%9B%A0%E7%B4%A0%E8%AE%A4%E8%AF%81/"},{"categories":["VPN"],"content":"é…ç½®pam echo \"auth requisite pam_oath.so debug usersfile=/etc/ocserv/ocserv.otp window=20\" \u003e\u003e /etc/pam.d/ocserv ","date":"2022-07-21","objectID":"/openconnect%E5%8F%8C%E5%9B%A0%E7%B4%A0%E8%AE%A4%E8%AF%81/:0:2","tags":["Openconnect","Ocserv"],"title":"OpenconnectåŒå› ç´ è®¤è¯","uri":"/openconnect%E5%8F%8C%E5%9B%A0%E7%B4%A0%E8%AE%A4%E8%AF%81/"},{"categories":["VPN"],"content":"åˆ›å»ºç”¨æˆ·OTP username=\"zengshenglong\" company=\"Company\" site_name=\"Site\" key=$(head -c 16 /dev/urandom |xxd -c 256 -ps) echo \"HOTP/T30 ${username} - ${key}\" \u003e\u003e/etc/ocserv/ocserv.otp oathtool --totp -w 5 $key secret=$(echo 0x${key}|xxd -r -c 256|base32) echo \"otpauth://hotp/${username}@${site_name}?secret=${secret}\u0026issuer=${company}\" | qrencode -o - -t UTF8 echo \"https://www.google.com/chart?chs=200x200\u0026chld=M|0\u0026cht=qr\u0026chl=otpauth://hotp/${username}@${site_name}?secret=$(echo ${secret}|cut -d = -f 1)\u0026issuer=${company}\" ","date":"2022-07-21","objectID":"/openconnect%E5%8F%8C%E5%9B%A0%E7%B4%A0%E8%AE%A4%E8%AF%81/:0:3","tags":["Openconnect","Ocserv"],"title":"OpenconnectåŒå› ç´ è®¤è¯","uri":"/openconnect%E5%8F%8C%E5%9B%A0%E7%B4%A0%E8%AE%A4%E8%AF%81/"},{"categories":["VPN"],"content":"å®Œæ•´é…ç½® auth = \"plain[passwd=/etc/ocserv/ocpasswd,otp=/etc/ocserv/ocserv.otp]\" tcp-port = 443 udp-port = 443 run-as-user = nobody run-as-group = daemon socket-file = /var/run/ocserv-socket server-cert = /etc/letsencrypt/live/myvpn.alongparty.cn/fullchain.pem server-key = /etc/letsencrypt/live/myvpn.alongparty.cn/privkey.pem isolate-workers = false banner = \"Welcome PCI DSS environment, please proceed with caution ! !\" pre-login-banner = \"You will enter the PCI DSS environment, please proceed with caution ! !\" max-clients = 16 max-same-clients = 2 rate-limit-ms = 100 server-stats-reset-time = 604800 keepalive = 32400 dpd = 90 mobile-dpd = 1800 switch-to-tcp-timeout = 25 try-mtu-discovery = true cert-user-oid = 0.9.2342.19200300.100.1.1 tls-priorities = \"NORMAL:%SERVER_PRECEDENCE:%COMPAT:-VERS-SSL3.0:-VERS-TLS1.0:-VERS-TLS1.1\" auth-timeout = 240 min-reauth-time = 300 max-ban-score = 80 ban-reset-time = 1200 cookie-timeout = 300 deny-roaming = false rekey-time = 172800 rekey-method = ssl use-occtl = true pid-file = /var/run/ocserv.pid device = vpns predictable-ips = true default-domain = example.com ipv4-network = 10.255.255.0 ipv4-netmask = 255.255.255.0 tunnel-all-dns = true dns = 8.8.8.8 dns = 4.2.2.4 dns = 2001:4860:4860::8888 dns = 2001:4860:4860::8844 ping-leases = false config-per-group = /etc/ocserv/group default-group-config = /etc/ocserv/group/default default-select-group = default auto-select-group = false cisco-client-compat = true dtls-legacy = true ","date":"2022-07-21","objectID":"/openconnect%E5%8F%8C%E5%9B%A0%E7%B4%A0%E8%AE%A4%E8%AF%81/:0:4","tags":["Openconnect","Ocserv"],"title":"OpenconnectåŒå› ç´ è®¤è¯","uri":"/openconnect%E5%8F%8C%E5%9B%A0%E7%B4%A0%E8%AE%A4%E8%AF%81/"},{"categories":["golang"],"content":"åˆå§‹åŒ–demoé¡¹ç›® mkdir -p gin-middleware-demo cd gin-middleware-demo go mod init github.com/kbsonlong/gin-middleware-demo middleware/middle.go package middleware import ( \"fmt\" \"time\" \"github.com/gin-gonic/gin\" ) func MdOne() gin.HandlerFunc { return func(c *gin.Context) { fmt.Println(\"å¼€å§‹æ‰§è¡Œç¬¬ä¸€ä¸ª gin ä¸­é—´ä»¶:\" + time.Now().String()) c.Next() fmt.Println(\"ç¬¬ä¸€ä¸ª gin ä¸­é—´ä»¶è¿”å›å†…å®¹:\" + time.Now().String()) } } func MdTwo() gin.HandlerFunc { return func(c *gin.Context) { fmt.Println(\"å¼€å§‹æ‰§è¡Œç¬¬äºŒä¸ª gin ä¸­é—´ä»¶:\" + time.Now().String()) c.Next() fmt.Println(\"ç¬¬äºŒä¸ª gin ä¸­é—´ä»¶è¿”å›å†…å®¹:\" + time.Now().String()) } } func MdThree() gin.HandlerFunc { return func(c *gin.Context) { fmt.Println(\"å¼€å§‹æ‰§è¡Œç¬¬ä¸‰ä¸ª gin ä¸­é—´ä»¶:\" + time.Now().String()) c.Next() fmt.Println(\"ç¬¬ä¸‰ä¸ª gin ä¸­é—´ä»¶è¿”å›å†…å®¹:\" + time.Now().String()) } } routers/router.go package routers import ( \"github.com/gin-gonic/gin\" \"github.com/kbsonlong/gin-middleware-demo/middleware\" ) func InitRouter() *gin.Engine { r := gin.New() r.Use(middleware.MdOne()) r.Use(middleware.MdTwo()) r.Use(middleware.MdThree()) gin.SetMode(\"debug\") r.GET(\"/\", func(ctx *gin.Context) { ctx.JSON(200, gin.H{ \"message\": \"test\", }) }) return r } main.go package main import ( \"github.com/kbsonlong/gin-middleware-demo/routers\" ) func main() { router := routers.InitRouter() router.Run() } ","date":"2022-07-08","objectID":"/gin%E4%B8%AD%E9%97%B4%E4%BB%B6%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F/:0:1","tags":["Gin"],"title":"äº†è§£Ginä¸­é—´ä»¶æ‰§è¡Œé¡ºåº","uri":"/gin%E4%B8%AD%E9%97%B4%E4%BB%B6%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F/"},{"categories":["golang"],"content":"è¿è¡Œæµ‹è¯• go mod tidy go run main.go [GIN-debug] [WARNING] Running in \"debug\" mode. Switch to \"release\" mode in production. - using env: export GIN_MODE=release - using code: gin.SetMode(gin.ReleaseMode) [GIN-debug] GET / --\u003e github.com/kbsonlong/gin-middleware-demo/routers.InitRouter.func1 (4 handlers) [GIN-debug] [WARNING] You trusted all proxies, this is NOT safe. We recommend you to set a value. Please check https://pkg.go.dev/github.com/gin-gonic/gin#readme-don-t-trust-all-proxies for details. [GIN-debug] Environment variable PORT is undefined. Using port :8080 by default [GIN-debug] Listening and serving HTTP on :8080 å¦ä¸€ç»ˆç«¯æ‰§è¡Œ curl 127.0.0.1:8080 {\"message\":\"test\"} å¯ä»¥çœ‹åˆ°æ§åˆ¶å°è¾“å‡ºå†…å®¹ å¼€å§‹æ‰§è¡Œç¬¬ä¸€ä¸ª gin ä¸­é—´ä»¶:2022-07-08 17:18:57.499033 +0800 CST m=+3.029327751 å¼€å§‹æ‰§è¡Œç¬¬äºŒä¸ª gin ä¸­é—´ä»¶:2022-07-08 17:18:57.499215 +0800 CST m=+3.029509918 å¼€å§‹æ‰§è¡Œç¬¬ä¸‰ä¸ª gin ä¸­é—´ä»¶:2022-07-08 17:18:57.499218 +0800 CST m=+3.029513043 ç¬¬ä¸‰ä¸ª gin ä¸­é—´ä»¶è¿”å›å†…å®¹:2022-07-08 17:18:57.499295 +0800 CST m=+3.029589876 ç¬¬äºŒä¸ª gin ä¸­é—´ä»¶è¿”å›å†…å®¹:2022-07-08 17:18:57.499298 +0800 CST m=+3.029593335 ç¬¬ä¸€ä¸ª gin ä¸­é—´ä»¶è¿”å›å†…å®¹:2022-07-08 17:18:57.4993 +0800 CST m=+3.029594876 è°ƒæ•´ä¸­é—´ä»¶Useé¡ºåº ...... r.Use(middleware.MdOne()) r.Use(middleware.MdThree()) r.Use(middleware.MdTwo()) gin.SetMode(\"debug\") ...... ç¬¬äºŒä¸ªä¸­é—´ä»¶å’Œç¬¬ä¸‰ä¸ªä¸­é—´ä»¶é¡ºåºå¯¹è°ƒ å¼€å§‹æ‰§è¡Œç¬¬ä¸€ä¸ª gin ä¸­é—´ä»¶:2022-07-08 17:20:57.702026 +0800 CST m=+2.567931210 å¼€å§‹æ‰§è¡Œç¬¬ä¸‰ä¸ª gin ä¸­é—´ä»¶:2022-07-08 17:20:57.702215 +0800 CST m=+2.568120210 å¼€å§‹æ‰§è¡Œç¬¬äºŒä¸ª gin ä¸­é—´ä»¶:2022-07-08 17:20:57.702218 +0800 CST m=+2.568123543 ç¬¬äºŒä¸ª gin ä¸­é—´ä»¶è¿”å›å†…å®¹:2022-07-08 17:20:57.702305 +0800 CST m=+2.568210460 ç¬¬ä¸‰ä¸ª gin ä¸­é—´ä»¶è¿”å›å†…å®¹:2022-07-08 17:20:57.702308 +0800 CST m=+2.568214043 ç¬¬ä¸€ä¸ª gin ä¸­é—´ä»¶è¿”å›å†…å®¹:2022-07-08 17:20:57.702311 +0800 CST m=+2.568216293 å¯ä»¥çœ‹åˆ°ç¬¬ä¸‰ä¸ªä¸­é—´ä»¶åœ¨ç¬¬äºŒä¸ªä¸­é—´ä»¶ä¹‹å‰æ‰§è¡Œ æ³¨é‡Šç¬¬ä¸‰ä¸ªä¸­é—´ä»¶Next func MdThree() gin.HandlerFunc { return func(c *gin.Context) { fmt.Println(\"å¼€å§‹æ‰§è¡Œç¬¬ä¸‰ä¸ª gin ä¸­é—´ä»¶:\" + time.Now().String()) // c.Next() fmt.Println(\"ç¬¬ä¸‰ä¸ª gin ä¸­é—´ä»¶è¿”å›å†…å®¹:\" + time.Now().String()) } } å¼€å§‹æ‰§è¡Œç¬¬ä¸€ä¸ª gin ä¸­é—´ä»¶:2022-07-08 17:22:43.132983 +0800 CST m=+4.061931376 å¼€å§‹æ‰§è¡Œç¬¬ä¸‰ä¸ª gin ä¸­é—´ä»¶:2022-07-08 17:22:43.133126 +0800 CST m=+4.062074668 ç¬¬ä¸‰ä¸ª gin ä¸­é—´ä»¶è¿”å›å†…å®¹:2022-07-08 17:22:43.133128 +0800 CST m=+4.062076751 å¼€å§‹æ‰§è¡Œç¬¬äºŒä¸ª gin ä¸­é—´ä»¶:2022-07-08 17:22:43.13313 +0800 CST m=+4.062078210 ç¬¬äºŒä¸ª gin ä¸­é—´ä»¶è¿”å›å†…å®¹:2022-07-08 17:22:43.133203 +0800 CST m=+4.062151335 ç¬¬ä¸€ä¸ª gin ä¸­é—´ä»¶è¿”å›å†…å®¹:2022-07-08 17:22:43.133205 +0800 CST m=+4.062153460 ","date":"2022-07-08","objectID":"/gin%E4%B8%AD%E9%97%B4%E4%BB%B6%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F/:0:2","tags":["Gin"],"title":"äº†è§£Ginä¸­é—´ä»¶æ‰§è¡Œé¡ºåº","uri":"/gin%E4%B8%AD%E9%97%B4%E4%BB%B6%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F/"},{"categories":["golang"],"content":"æ€»ç»“ Ginä¸­é—´ä»¶çš„è°ƒç”¨é¡ºåºä¸Useé¡ºåºæœ‰å…³ï¼Œä»£ç è¿è¡Œé¡ºåºå’ŒNextå‰åé¡ºåºæœ‰å…³ã€‚ Nextä¹‹å‰ä»£ç å…ˆè¿›å…ˆå‡º Nextä¹‹åä»£ç åè¿›å…ˆå‡º æ²¡æœ‰å¼•ç”¨Nextä»£ç ç›´æ¥è¿è¡Œ ","date":"2022-07-08","objectID":"/gin%E4%B8%AD%E9%97%B4%E4%BB%B6%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F/:0:3","tags":["Gin"],"title":"äº†è§£Ginä¸­é—´ä»¶æ‰§è¡Œé¡ºåº","uri":"/gin%E4%B8%AD%E9%97%B4%E4%BB%B6%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F/"},{"categories":null,"content":"Hey Welcome here ğŸ‘‹ ","date":"2022-05-24","objectID":"/about/:1:0","tags":null,"title":"","uri":"/about/"},{"categories":null,"content":"æ­£åœ¨å­¦ä¹  ","date":"2022-05-24","objectID":"/about/:2:0","tags":null,"title":"","uri":"/about/"},{"categories":null,"content":"Service Mesh ","date":"2022-05-24","objectID":"/about/:2:1","tags":null,"title":"","uri":"/about/"},{"categories":null,"content":"Vue ","date":"2022-05-24","objectID":"/about/:2:2","tags":null,"title":"","uri":"/about/"},{"categories":null,"content":"Go ","date":"2022-05-24","objectID":"/about/:2:3","tags":null,"title":"","uri":"/about/"},{"categories":null,"content":"æ±‡ç¼–å’Œå·¥å…·: ğŸ›  Check for a detailed stats here :point_right: Sourcerer ","date":"2022-05-24","objectID":"/about/:3:0","tags":null,"title":"","uri":"/about/"},{"categories":["äº‘åŸç”Ÿ"],"content":"1é™æµ ","date":"2022-05-23","objectID":"/istio%E9%98%B2%E6%95%85%E9%9A%9C%E5%88%A9%E5%99%A8/:0:0","tags":["istio"],"title":"Istioé˜²æ•…éšœåˆ©å™¨","uri":"/istio%E9%98%B2%E6%95%85%E9%9A%9C%E5%88%A9%E5%99%A8/"},{"categories":["äº‘åŸç”Ÿ"],"content":"1.1ä»€ä¹ˆæ˜¯é™æµ â€‹ ä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚æˆ‘ä»¬æœ‰ä¸ªæ¡¶ï¼Œæ¡¶é‡Œæœ‰ä¸¤ä¸ªå¼€å…³ï¼Œä¸€ä¸ªå¾€å¤–å‡ºæ°´ï¼Œä¸€ä¸ªç½‘å†…æ³¨æ°´ï¼Œå½“å‡ºæ°´çš„é€Ÿåº¦æ…¢äºæ³¨æ°´çš„é€Ÿåº¦æ—¶ï¼Œåˆ°ä¸€å®šæ—¶é—´æ°´å°±ä¼šä»æ¡¶é‡Œæº¢å‡ºã€‚å¦‚æœæˆ‘ä»¬é™åˆ¶æ³¨æ°´é€Ÿç‡ï¼Œå°±å¯ä»¥é˜²æ­¢æ°´ä»æ¡¶é‡Œæº¢å‡ºï¼Œè¿™å°±æ˜¯é™æµã€‚ â€‹ å…·ä½“åˆ°è½¯ä»¶å±‚é¢ï¼Œæˆ‘ä»¬æŠŠè¯·æ±‚é€Ÿç‡çœ‹åšæ˜¯æ³¨æ°´ï¼ŒæŠŠç³»ç»Ÿcpuï¼Œå†…å­˜ç­‰èµ„æºçœ‹åšæ˜¯æ”¾æ°´ï¼Œå½“è¯·æ±‚é€Ÿç‡è¿‡å¿«ï¼Œæ¶ˆè€—å¤ªå¤šèµ„æºæ—¶ç³»ç»Ÿå°±å¯èƒ½å´©æºƒã€‚è½¯ä»¶é™æµå°±æ˜¯é™åˆ¶tpsæˆ–qpsæŒ‡æ ‡ï¼Œä»¥è¾¾åˆ°ä¿æŠ¤ç³»ç»Ÿçš„ç›®çš„ï¼Œè™½ç„¶å¯èƒ½éƒ¨åˆ†ç”¨æˆ·æ— æ³•æœåŠ¡ï¼Œä½†æ˜¯ç³»ç»Ÿæ•´ä½“è¿˜æ˜¯å¥åº·çš„ï¼Œè¿˜å¯ä»¥å¯¹å¤–éƒ¨æä¾›æœåŠ¡ï¼Œä¸æ˜¯æ•´ä½“æŒ‚æ‰ã€‚ ","date":"2022-05-23","objectID":"/istio%E9%98%B2%E6%95%85%E9%9A%9C%E5%88%A9%E5%99%A8/:1:0","tags":["istio"],"title":"Istioé˜²æ•…éšœåˆ©å™¨","uri":"/istio%E9%98%B2%E6%95%85%E9%9A%9C%E5%88%A9%E5%99%A8/"},{"categories":["äº‘åŸç”Ÿ"],"content":"1.2é™æµç®—æ³• 1.2.1æ¼æ¡¶ç®—æ³• å°±åƒä¸€ä¸ªæ¼æ–—ä»¥ä¸‹ï¼Œä¸‹é¢å°ï¼Œä¸Šé¢å¤§ã€‚æ¼æ¡¶æµå‡ºçš„é€Ÿç‡è¢«é™åˆ¶åœ¨æ¯”è¾ƒå°çš„èŒƒå›´ï¼Œå½“æ¼æ¡¶æ»¡æ—¶ï¼Œæ¼æ¡¶å°±ä¼šæº¢å‡ºï¼Œè¿›æ¥çš„è¯·æ±‚å°±ä¼šè¢«æŠ›å¼ƒæ‰ã€‚ç‰¹åˆ«æ˜¯åº”å¯¹çªå‘æµé‡ï¼Œæ¼æ¡¶çš„é€Ÿç‡æ˜¯æ’å®šçš„ï¼Œè¿™æ ·å¯ä»¥æœ‰æ•ˆé˜²æ­¢åº”çªå‘æµé‡å¯¼è‡´ç³»ç»Ÿå´©æºƒã€‚ ","date":"2022-05-23","objectID":"/istio%E9%98%B2%E6%95%85%E9%9A%9C%E5%88%A9%E5%99%A8/:2:0","tags":["istio"],"title":"Istioé˜²æ•…éšœåˆ©å™¨","uri":"/istio%E9%98%B2%E6%95%85%E9%9A%9C%E5%88%A9%E5%99%A8/"},{"categories":["äº‘åŸç”Ÿ"],"content":"1.2.2ä»¤ç‰Œæ¡¶ç®—æ³• ä»¤ç‰Œæ¡¶ç®—æ³•çš„åŸç†ï¼Œå…³é”®åœ¨ä»¤ç‰Œï¼Œå®ƒæ˜¯æŒ‡å¾€æ¡¶é‡Œä»¥ä¸€ä¸ªä¸å˜çš„é€Ÿç‡æ”¾å…¥ä»¤ç‰Œï¼Œå½“æœ‰è¯·æ±‚æ—¶ï¼Œå¦‚æœæ¡¶é‡Œæœ‰ä»¤ç‰Œï¼Œè¯·æ±‚å°±æ¶ˆè´¹ä¸€ä¸ªä»¤ç‰Œï¼Œè¯·æ±‚ç»§ç»­è¿›è¡Œï¼›å½“è¯·æ±‚åˆ°æ¥ï¼Œæ¡¶é‡Œæ²¡æœ‰ä»¤ç‰Œæ—¶ï¼Œè¯·æ±‚å°±ä¼šè¢«æŠ›å¼ƒæ‰ï¼Œæ‹’ç»æœåŠ¡ï¼›å½“æ¡¶é‡Œçš„ä»¤ç‰Œæ»¡æ—¶ï¼Œä»¤ç‰Œå°±ä¼šè¢«æŠ›å¼ƒæ‰ã€‚ ","date":"2022-05-23","objectID":"/istio%E9%98%B2%E6%95%85%E9%9A%9C%E5%88%A9%E5%99%A8/:2:1","tags":["istio"],"title":"Istioé˜²æ•…éšœåˆ©å™¨","uri":"/istio%E9%98%B2%E6%95%85%E9%9A%9C%E5%88%A9%E5%99%A8/"},{"categories":["äº‘åŸç”Ÿ"],"content":"1.2.3è®¡æ•°å™¨ç®—æ³• è®¡æ•°å™¨ç®—æ³•æ˜¯æŒ‡ä¸€æ®µæ—¶é—´è®¾ç½®ä¸€ä¸ªè®¡æ•°å™¨ï¼Œå½“æœ‰è¯·æ±‚æ—¶è®¡æ•°å™¨å°±åŠ ä¸€ï¼Œè¯·æ±‚ç»§ç»­è¿›è¡Œï¼›åœ¨æŠ€æœ¯å™¨æ—¶é—´èŒƒå›´å†…ï¼Œå½“è®¡æ•°å™¨æ•°å€¼è¶…è¿‡æŒ‡å®šå€¼ï¼Œè¯·æ±‚å°±è¢«æ‹’ç»ï¼›å½“æ—¶é—´èŒƒå›´ç»“æŸï¼Œå°±é‡ç½®è®¡æ•°å™¨ã€‚æŠ€æœ¯å™¨ç®—æ³•æœ‰ä¸ªç¼ºé™·ï¼Œå°±æ˜¯å¦‚æœè®¡æ•°å™¨æ—¶é—´æ˜¯1åˆ†é’Ÿï¼Œå½“å‰1ç§’æ¥äº†å¤§é‡è¯·æ±‚ï¼Œè®²æŠ€æœ¯å™¨ç”¨å®Œäº†ï¼Œåç»­59ç§’æ—¶é—´å°±æ²¡æ³•æä¾›æœåŠ¡ã€‚ ","date":"2022-05-23","objectID":"/istio%E9%98%B2%E6%95%85%E9%9A%9C%E5%88%A9%E5%99%A8/:2:2","tags":["istio"],"title":"Istioé˜²æ•…éšœåˆ©å™¨","uri":"/istio%E9%98%B2%E6%95%85%E9%9A%9C%E5%88%A9%E5%99%A8/"},{"categories":["äº‘åŸç”Ÿ"],"content":"1.2å®æ“ ","date":"2022-05-23","objectID":"/istio%E9%98%B2%E6%95%85%E9%9A%9C%E5%88%A9%E5%99%A8/:3:0","tags":["istio"],"title":"Istioé˜²æ•…éšœåˆ©å™¨","uri":"/istio%E9%98%B2%E6%95%85%E9%9A%9C%E5%88%A9%E5%99%A8/"},{"categories":["äº‘åŸç”Ÿ"],"content":"1.2.1 http 1.2.1.1å•é›†ç¾¤ istioéƒ¨ç½²å’Œbookinfoå®ä¾‹éƒ¨ç½²å¤§å®¶è‡ªè¡Œå®Œæˆï¼Œéƒ½çœ‹è¿™ç§æ·±åº¦çš„æ–‡ç« äº†è¿™ä¸ªåº”è¯¥ä¸æ˜¯äº‹ã€‚ 1.2.1.1.1é›†ç¾¤å†…æœåŠ¡é™æµ 1.2.1.1.1.1æœ¬åœ°é™æµ cat \u003c\u003cEOF \u003e envoyfilter-local-rate-limit.yaml apiVersion: networking.istio.io/v1alpha3 kind: EnvoyFilter metadata: name: filter-local-ratelimit-svc spec: workloadSelector: labels: app: productpage configPatches: - applyTo: HTTP_FILTER match: listener: filterChain: filter: name: \"envoy.filters.network.http_connection_manager\" patch: operation: INSERT_BEFORE value: name: envoy.filters.http.local_ratelimit typed_config: \"@type\": type.googleapis.com/udpa.type.v1.TypedStruct type_url: type.googleapis.com/envoy.extensions.filters.http.local_ratelimit.v3.LocalRateLimit value: stat_prefix: http_local_rate_limiter token_bucket: max_tokens: 10 tokens_per_fill: 10 fill_interval: 60s filter_enabled: runtime_key: local_rate_limit_enabled default_value: numerator: 100 denominator: HUNDRED filter_enforced: runtime_key: local_rate_limit_enforced default_value: numerator: 100 denominator: HUNDRED response_headers_to_add: - append: false header: key: x-local-rate-limit value: 'true' EOF kubectl apply -f envoyfilter-local-rate-limit.yaml -n istio è¯´æ˜ï¼šæœ¬åœ°é™æµéœ€è¦é€šè¿‡EnvoyFilteræ¥å®ç°ï¼Œä»–ä¸ä¼šè¯·æ±‚å¤–éƒ¨æœåŠ¡ï¼Œåœ¨envoyå†…éƒ¨å®ç°æ”¯æŒï¼Œæ˜¯ä¸€ä¸ªä»¤ç‰Œæ¡¶çš„ç®—æ³•ã€‚http filterçš„åç§°å¿…é¡»æ˜¯envoy.filters.http.local_ratelimitï¼Œtypeå’Œtypeurlæ˜¯å›ºå®šçš„ï¼Œstat_prefixå¯ä»¥éšä¾¿æ”¹ï¼Œè¡¨ç¤ºç”Ÿæˆstatçš„æŒ‡æ ‡å‰ç¼€ã€‚token_bucketé…ç½®ä»¤ç‰Œæ¡¶ï¼Œmax_tokensè¡¨ç¤ºæœ€å¤§ä»¤ç‰Œæ•°é‡ï¼Œtokens_per_fillè¡¨ç¤ºæ¯æ¬¡å¡«å……çš„ä»¤ç‰Œæ•°é‡ï¼Œfill_intervalè¡¨ç¤ºå¡«å……ä»¤ç‰Œçš„é—´éš”ã€‚filter_enabledè¡¨ç¤ºå¯ç”¨ä½†ä¸æ˜¯å¼ºåˆ¶ï¼Œfilter_enforcedè¡¨ç¤ºå¼ºåˆ¶ï¼Œå¯ä»¥é…ç½®ç™¾åˆ†æ¯”ã€‚response_headers_to_addä¿®æ”¹å“åº”å¤´ä¿¡æ¯ï¼Œappendä¸ºfalseè¡¨ç¤ºä¿®æ”¹ï¼Œtrueè¡¨ç¤ºæ·»åŠ ã€‚runtime_key è¿è¡Œæ—¶çš„keyï¼Œå…·ä½“æœ‰å•¥ç”¨ä¸æ¸…æ¥šã€‚ æ‰§è¡Œå‹æµ‹ï¼š [root@node01 45]# go-stress-testing -c 10 -n 10000 -u http://192.168.229.134:30945/productpage å¼€å§‹å¯åŠ¨ å¹¶å‘æ•°:10 è¯·æ±‚æ•°:10000 è¯·æ±‚å‚æ•°: request: form:http url:http://192.168.229.134:30945/productpage method:GET headers:map[] data: verify:statusCode timeout:30s debug:false â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€ è€—æ—¶â”‚ å¹¶å‘æ•°â”‚ æˆåŠŸæ•°â”‚ å¤±è´¥æ•°â”‚ qps â”‚æœ€é•¿è€—æ—¶â”‚æœ€çŸ­è€—æ—¶â”‚å¹³å‡è€—æ—¶â”‚ä¸‹è½½å­—èŠ‚â”‚å­—èŠ‚æ¯ç§’â”‚ é”™è¯¯ç  â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€ 1sâ”‚ 7â”‚ 2â”‚ 761â”‚ 2.94â”‚ 124.68â”‚ 1.98â”‚ 3406.97â”‚ 21,476â”‚ 21,470â”‚200:2;429:761 2sâ”‚ 10â”‚ 5â”‚ 1636â”‚ 2.55â”‚ 1788.46â”‚ 1.98â”‚ 3928.11â”‚ 52,771â”‚ 26,383â”‚200:5;429:1636 3sâ”‚ 10â”‚ 5â”‚ 2962â”‚ 1.70â”‚ 1788.46â”‚ 1.04â”‚ 5871.68â”‚ 76,639â”‚ 25,545â”‚200:5;429:2962 4sâ”‚ 10â”‚ 5â”‚ 4459â”‚ 1.28â”‚ 1788.46â”‚ 1.04â”‚ 7810.78â”‚ 103,585â”‚ 25,896â”‚200:5;429:4459 429 Too Many Requests (å¤ªå¤šè¯·æ±‚) å½“ä½ éœ€è¦é™åˆ¶å®¢æˆ·ç«¯è¯·æ±‚æŸä¸ªæœåŠ¡çš„æ•°é‡ï¼Œä¹Ÿå°±æ˜¯é™åˆ¶è¯·æ±‚é€Ÿåº¦æ—¶ï¼Œè¯¥çŠ¶æ€ç å°±ä¼šéå¸¸æœ‰ç”¨ æ¸…ç†ï¼š kubectl delete envoyfilter filter-local-ratelimit-svc -n istio 1.2.1.1.1.2å…¨å±€é™æµ éƒ¨ç½²ratelimit 1åˆ›å»ºcm cat \u003c\u003c EOF \u003e ratelimit-config.yaml apiVersion: v1 kind: ConfigMap metadata: name: ratelimit-config data: config.yaml: | domain: productpage-ratelimit descriptors: - key: PATH value: \"/productpage\" rate_limit: unit: minute requests_per_unit: 1 - key: PATH rate_limit: unit: minute requests_per_unit: 100 EOF kubectl apply -f ratelimit-config.yaml -n istio è¯´æ˜: è¿™ä¸ªconfigmapæ˜¯é™é€ŸæœåŠ¡ç”¨åˆ°çš„é…ç½®æ–‡ä»¶ï¼Œä»–æ˜¯envoy v3ç‰ˆæœ¬çš„é™é€Ÿæ ¼å¼ã€‚domainæ˜¯åŸŸåï¼Œä»–ä¼šåœ¨envoyfilterä¸­è¢«å¼•ç”¨ï¼Œdescriptorsçš„PATH,è¡¨ç¤ºè¯·æ±‚çš„è·¯å¾„å¯ä»¥æœ‰å¤šä¸ªå€¼ï¼Œrate_limité…ç½®é™é€Ÿé…é¢ï¼Œè¿™é‡Œproductpageé…äº†1åˆ†é’Ÿ1ä¸ªè¯·æ±‚ï¼Œå…¶ä»–urlæ˜¯1åˆ†é’Ÿ100ä¸ªè¯·æ±‚ 2åˆ›å»ºé™é€ŸæœåŠ¡deployment cat \u003c\u003c EOF \u003e ratelimit-deploy.yaml apiVersion: v1 kind: Service metadata: name: redis labels: app: redis spec: ports: - name: redis port: 6379 selector: app: redis --- apiVersion: apps/v1 kind: Deployment metadata: name: redis spec: replicas: 1 selector: matchLabels: app: redis template: metadata: labels: app: redis spec: containers: - image: redis:alpine imagePullPolicy: Always name: redis ports: - name: redis containerPort: 6379 restartPolicy: Always serviceAccountName: \"\" --- apiVersion: v1 kind: Service metadata: name: ratelimit labels: app: ratelimit spec: ports: - name: http-port port: 8080 targetPort: 8080 protocol: TCP - name: grpc-port port: 8081 targetPort: 8081 protocol: TCP - name: http-debug port: 6070 targetPort: 6070 protocol: TCP selector: app: ratelimit --- apiVersion: apps/v1 kind: Deployment metadata: name: ratelimit spec: replicas: 1 selector: matchLabels: app: ratelimit strategy: type: Recreate template: metadata: labe","date":"2022-05-23","objectID":"/istio%E9%98%B2%E6%95%85%E9%9A%9C%E5%88%A9%E5%99%A8/:3:1","tags":["istio"],"title":"Istioé˜²æ•…éšœåˆ©å™¨","uri":"/istio%E9%98%B2%E6%95%85%E9%9A%9C%E5%88%A9%E5%99%A8/"},{"categories":null,"content":"kbsonlong's friends","date":"2022-05-23","objectID":"/friends/","tags":null,"title":"","uri":"/friends/"},{"categories":null,"content":"Base info - nickname: èœ·ç¼©çš„èœ—ç‰› avatar: images/20220524130401.png url: https://www.alongparty.cn description: è¿ç»´è‡ªåŠ¨åŒ– ","date":"2022-05-23","objectID":"/friends/:1:0","tags":null,"title":"","uri":"/friends/"},{"categories":null,"content":"Friendly Reminder Notice If you want to exchange link, please leave a comment in the above format. (personal non-commercial blogs / websites only) Â Website failure, stop maintenance and improper content may be unlinked! Those websites that do not respect other peopleâ€™s labor achievements, reprint without source, or malicious acts, please do not come to exchange. ","date":"2022-05-23","objectID":"/friends/:2:0","tags":null,"title":"","uri":"/friends/"},{"categories":["äº‘åŸç”Ÿ"],"content":"å‹æµ‹å¤§çº² å‹æµ‹çš„å¿…è¦æ€§ å‹æµ‹éƒ¨ç½²æ¶æ„å›¾ ç¯å¢ƒå‡†å¤‡ ","date":"2022-05-23","objectID":"/istio%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95/:0:0","tags":["istio"],"title":"Istioæ€§èƒ½æµ‹è¯•","uri":"/istio%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95/"},{"categories":["äº‘åŸç”Ÿ"],"content":"éƒ¨ç½² Istio ","date":"2022-05-23","objectID":"/istio%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95/:1:0","tags":["istio"],"title":"Istioæ€§èƒ½æµ‹è¯•","uri":"/istio%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95/"},{"categories":["äº‘åŸç”Ÿ"],"content":"éƒ¨ç½²ç›‘æ§ç»„ä»¶ ","date":"2022-05-23","objectID":"/istio%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95/:2:0","tags":["istio"],"title":"Istioæ€§èƒ½æµ‹è¯•","uri":"/istio%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95/"},{"categories":["äº‘åŸç”Ÿ"],"content":"éƒ¨ç½²å‹æµ‹æœåŠ¡ ","date":"2022-05-23","objectID":"/istio%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95/:3:0","tags":["istio"],"title":"Istioæ€§èƒ½æµ‹è¯•","uri":"/istio%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95/"},{"categories":["äº‘åŸç”Ÿ"],"content":"éƒ¨ç½²å‹æµ‹å·¥å…· æ€§èƒ½å‹æµ‹ å‹æµ‹æŠ¥å‘Š","date":"2022-05-23","objectID":"/istio%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95/:4:0","tags":["istio"],"title":"Istioæ€§èƒ½æµ‹è¯•","uri":"/istio%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95/"},{"categories":["hugo"],"content":"åˆ›å»ºGithub Actionsæµæ°´çº¿ mkdir -p .github/workflows/ touch hugo.yaml å‘å¸ƒåˆ°æœ¬ä»“åº“ name: GitHub Pages Deploy Local REPOSITORY on: push: branches: - master # Set a branch to deploy pull_request: jobs: deploy: runs-on: ubuntu-20.04 concurrency: group: ${{ github.workflow }}-${{ github.ref }} steps: - uses: actions/checkout@v3 with: submodules: true # Fetch Hugo themes (true OR recursive) fetch-depth: 1 # Fetch all history for .GitInfo and .Lastmod - name: Setup Hugo uses: peaceiris/actions-hugo@v2 with: hugo-version: '0.91.2' extended: true - name: Build run: hugo --minify - name: Deploy uses: peaceiris/actions-gh-pages@v3 with: github_token: ${{ secrets.GITHUB_TOKEN }} publish_dir: ./public å‘å¸ƒåˆ°å¦å¤–ä»“åº“ name: CI #è‡ªåŠ¨åŒ–çš„åç§° on: push: # pushçš„æ—¶å€™è§¦å‘ branches: # é‚£äº›åˆ†æ”¯éœ€è¦è§¦å‘ - master jobs: deploy: runs-on: ubuntu-20.04 steps: - uses: actions/checkout@v2 with: submodules: true # Fetch Hugo themes (true OR recursive) fetch-depth: 1 # Fetch all history for .GitInfo and .Lastmod - name: Setup Hugo uses: peaceiris/actions-hugo@v2 with: hugo-version: 'latest' extended: true - name: Build run: hugo --minify - name: Deploy uses: peaceiris/actions-gh-pages@v3 with: personal_token: ${{ secrets.EXTERNAL_REPOSITORY_TOKEN }} publish_dir: ./public external_repository: kbsonlong/devops.alongparty.cn æ³¨æ„: å‘å¸ƒåˆ°æœ¬ä»“åº“github_tokenä¸éœ€è¦æ‰‹åŠ¨åˆ›å»ºGITHUB_TOKEN, å‘å¸ƒåˆ°å…¶ä»–ä»“åº“personal_tokenéœ€è¦æå‰åˆ›å»ºå¹¶é…ç½®secretå˜é‡ åˆ›å»ºSSHè¯ä¹¦ ssh-keygen -t rsa -b 4096 -C \"$(git config user.email)\" -f gh-pages -N \"\" é…ç½®SSHå…¬é’¥ é…ç½®SSHç§é’¥ ä½¿ç”¨SSHç§é’¥å‘å¸ƒ name: CI #è‡ªåŠ¨åŒ–çš„åç§° on: push: # pushçš„æ—¶å€™è§¦å‘ branches: # é‚£äº›åˆ†æ”¯éœ€è¦è§¦å‘ - master jobs: deploy: runs-on: ubuntu-20.04 steps: - uses: actions/checkout@v2 with: submodules: true # Fetch Hugo themes (true OR recursive) fetch-depth: 1 # Fetch all history for .GitInfo and .Lastmod - name: Setup Hugo uses: peaceiris/actions-hugo@v2 with: hugo-version: 'latest' extended: true - name: Build run: hugo --minify - name: Deploy with PRIVATE KEY uses: peaceiris/actions-gh-pages@v3 with: cname: devops.alongparty.cn env: ACTIONS_DEPLOY_KEY: ${{ secrets.HUGO_DEPLOY_PRIVATE_KEY }} EXTERNAL_REPOSITORY: kbsonlong/devops.alongparty.cn PUBLISH_BRANCH: gh-pages PUBLISH_DIR: ./public æ³¨æ„: éƒ¨ç½²åˆ°å¦å¤–ä»“åº“æ—¶sshç§é’¥é…ç½®åœ¨æºä»“åº“, sshå…¬é’¥é…ç½®åœ¨ç›®æ ‡ä»“åº“æˆ–è€…å…¨å±€ ","date":"2022-05-23","objectID":"/github-actions%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2hugo%E5%8D%9A%E5%AE%A2/:0:1","tags":["github actions"],"title":"Github Actionsè‡ªåŠ¨éƒ¨ç½²hugoåšå®¢","uri":"/github-actions%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2hugo%E5%8D%9A%E5%AE%A2/"},{"categories":["hugo"],"content":"åˆ›å»ºGITHUB Personal TOKEN ","date":"2022-05-23","objectID":"/github-actions%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2hugo%E5%8D%9A%E5%AE%A2/:0:2","tags":["github actions"],"title":"Github Actionsè‡ªåŠ¨éƒ¨ç½²hugoåšå®¢","uri":"/github-actions%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2hugo%E5%8D%9A%E5%AE%A2/"},{"categories":["hugo"],"content":"åˆ›å»ºä»“åº“Secretså˜é‡ ","date":"2022-05-23","objectID":"/github-actions%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2hugo%E5%8D%9A%E5%AE%A2/:0:3","tags":["github actions"],"title":"Github Actionsè‡ªåŠ¨éƒ¨ç½²hugoåšå®¢","uri":"/github-actions%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2hugo%E5%8D%9A%E5%AE%A2/"},{"categories":["hugo"],"content":"Github Pageé…ç½®è‡ªå®šä¹‰åŸŸå echo \"\u003cè‡ªå®šä¹‰åŸŸå\u003e\" \u003estatic/CNAME ","date":"2022-05-23","objectID":"/github-actions%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2hugo%E5%8D%9A%E5%AE%A2/:0:4","tags":["github actions"],"title":"Github Actionsè‡ªåŠ¨éƒ¨ç½²hugoåšå®¢","uri":"/github-actions%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2hugo%E5%8D%9A%E5%AE%A2/"},{"categories":["hugo"],"content":"Deployæ—¶è¿‡æ»¤é™æ€æ–‡ä»¶ - name: Deploy uses: peaceiris/actions-gh-pages@v3 with: personal_token: ${{ secrets.EXTERNAL_REPOSITORY_TOKEN }} external_repository: kbsonlong/devops.alongparty.cn publish_branch: gh-pages # default: gh-pages publish_dir: ./public exclude_assets: './algolia.json,./*/*.md' # æ”¯æŒæ­£åˆ™è¿‡æ»¤,åŸºäºç¼–è¯‘åçš„é™æ€æ–‡ä»¶,æ ¹ç›®å½•publish_dir user_name: 'github-actions[bot]' user_email: 'github-actions[bot]@users.noreply.github.com' commit_message: ${{ github.event.head_commit.message }} tag_name: ${{ steps.prepare_tag.outputs.deploy_tag_name }} tag_message: 'Deployment ${{ steps.prepare_tag.outputs.tag_name }}' ","date":"2022-05-23","objectID":"/github-actions%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2hugo%E5%8D%9A%E5%AE%A2/:0:5","tags":["github actions"],"title":"Github Actionsè‡ªåŠ¨éƒ¨ç½²hugoåšå®¢","uri":"/github-actions%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2hugo%E5%8D%9A%E5%AE%A2/"},{"categories":null,"content":"ç¦»çº¿ - èœ·ç¼©çš„èœ—ç‰›","date":"0001-01-01","objectID":"/offline/","tags":null,"title":"","uri":"/offline/"},{"categories":null,"content":"Hey Welcome here ğŸ‘‹ ","date":"0001-01-01","objectID":"/offline/:1:0","tags":null,"title":"","uri":"/offline/"},{"categories":null,"content":"ç›®å‰æ­£åœ¨å­¦ä¹ Service Mesh ","date":"0001-01-01","objectID":"/offline/:2:0","tags":null,"title":"","uri":"/offline/"},{"categories":null,"content":"æ±‡ç¼–å’Œå·¥å…·: ğŸ›  Check for a detailed stats here :point_right: Sourcerer ","date":"0001-01-01","objectID":"/offline/:3:0","tags":null,"title":"","uri":"/offline/"}]